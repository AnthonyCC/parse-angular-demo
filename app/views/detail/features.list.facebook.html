<div class="row-fluid">
  <div class="navi-bar-title dark trans">

    <a class="navi-button-prev trans" href="#/features">
      Back
    </a>

        <h1 class="title trans">Parse & Facebook SDK</h1>


  </div>

  <div class="row-fluid width-padding top-padding bottom-padding">

    <div class="row-fluid center-align">
      <div class="row-fluid bottom-margin">
        <h1 class="punchy muted light-text-shadow"><i class="icon icon-facebook-sign small-right-margin"></i></h1>       
      </div>
    </div>
    <div class="row-fluid white-back withShadow withRadius width-padding top-padding bottom-padding center-align">
      

      <div class="row-fluid" >
        <div class="row-fluid bottom-margin">
          <div class="row-fluid center-align">
            <h4 class="power">Use a Promise to Init Parse.FacebookUtils</h4>
            <span class="muted">Allowing you to Asynchronously Load the Parse SDK and the Facebook SDK</span>
          </div>

        </div>

      </div>
      <div class="row-fluid left-align muted">
        We all know that we should asynchronously load the Facebook SDK near the closing <strong>body</strong> tag to speed up page loads. We load the Parse SDK here too instead of in the <strong>head </strong>for the same reason. But if you try to<strong> </strong>asynchronously load the <strong>Parse SDK and Facebook SDK</strong> you will run into the problem where Parse will try to call FB.init() at some point, and the FB object does not exist because the Facebook SDK has not yet loaded.

We developed an clever way to get around this. The key thing here is that Facebook calls a function <strong>window.fbAsyncInit</strong> as soon as the SDK is finished loading. We use this to resolve the <strong>window.fbPromise</strong>, which in turn is used to trigger <strong>Parse.FacebookUtils.init()</strong>. This method is flawless, and you never get any out of sync errors. Here's the code to define the <strong>fbPromise</strong>:<br/><br/>

<pre>

  var fbDeferred = $.Deferred();
  window.fbPromise = fbDeferred.promise();
  window.fbAsyncInit = function() {
    fbDeferred.resolve();
  };

</pre>

<br/><br/>... and here's the code to subsequently trigger the init()<br/><br/>

<pre>
// FACEBOOK init
window.fbPromise.then(function() {
  Parse.FacebookUtils.init({
    appId: /*** FB APP ID ***/, 
    channelUrl: /*** HTTP://YOURDOMAIN.COM/ ***/channel.html',
    cookie: true, // enable cookies to allow Parse to access the session
    xfbml: true, // parse XFBML
    frictionlessRequests: true // recommended
  });
});
</pre>

Simple, elegant, highly effective.

      </div>
        

    </div>

    <div class="top-margin">
      <a href="#/features" class="btn btn-block btn-secondary btn-large">Back</a>
    </div>
  </div>
    
</div>
